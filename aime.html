<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<!--        ğŸ’ æ„Ÿè°¢NAGEKI-NET~ ğŸ’
           ğŸ’ æ„Ÿè°¢è®¯é£æ˜Ÿç«å¤§æ¨¡å‹~ ğŸ’
ğŸ’ OpenSource without love by Eternal973~ ğŸ’-->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reigeki ID</title>
    <style>
        table {
            border-right: 1px solid #000000;
            border-bottom: 1px solid #000000;
            text-align: center;
        }
        
        table th {
            border-left: 1px solid #000000;
            border-top: 1px solid #000000;
        }
        
        table td {
            border-left: 1px solid #000000;
            border-top: 1px solid #000000;
        }
    </style>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <noscript>
        <h1>è¯·å…è®¸JavaScriptä»¥ç»§ç»­ä½¿ç”¨å£ç‰™ï¼</h1>
    </noscript>
    <table id="table" style="text-align: center; height: 50px; display: none;">
        <tr>
            <td colspan="4" style="font-size: 1.5em; font-weight: bold;">Reigeki é€šè¡Œè¯</td>
        </tr>
        <tr>
            <td>ç”¨æˆ·å</td>
            <td style="font-weight: bold;"></td>
            <td>ç”¨æˆ·ID</td>
            <td></td>
        </tr>
        <tr>
            <td>æœåŠ¡å™¨</td>
            <td colspan="3"><a href="https://ongeki.moe" style="color: inherit; text-decoration: none;">Nageki-Net</a>
            </td>
        </tr>
        <tr>
            <td>æ³¨å†Œæ—¶é—´</td>
            <td colspan="3"></td>
        </tr>
        <tr>
            <td rowspan="2">ç™»å½•äºŒç»´ç </td>
            <td colspan="3">
                <div id="qrcode" style="display: flex; align-items: center; justify-content: center;"></div>
            </td>
        </tr>
        <tr>
            <td colspan="3">
            </td>
        </tr>
    </table>
    <p style="color: darkred;" id="loading">Loadingâ€¦â€¦</p>
    <script>
        function readAimeId() {
            const para = location.search;
            const paraRegex = /([^=]+)=([^&]+)/g;
            let match;
            const paraArray = [];
            while ((match = paraRegex.exec(para)) !== null) {
                const key = match[1];
                const value = match[2];
                paraArray.push([key, value]);
            }
            if (para != "") {
                accessCode = paraArray[0][1];
                fetch('https://nageki.nananana.net/api/sega/aime/getByAccessCode', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 'accessCode': accessCode })
                })
                    .then(response => response.json())
                    .then(data => {
                        let aimeId;
                        if (data.id && data.extId) {
                            aimeId = data.extId;
                            luid = data.luid;
                            regTime = new Date(data.registerTime).toLocaleString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit' });
                            fetch(`https://nageki.nananana.net/api/game/ongeki/profile?aimeId=${aimeId}`)
                                .then(response => response.json())
                                .then(data => {
                                    if (data.userId && data.userName) {
                                        console.log(data.userName + `ç™»å½•æˆåŠŸ`)
                                        document.getElementById("table").rows[1].cells[1].innerHTML = data.userName;
                                        document.getElementById("table").rows[1].cells[3].innerHTML = data.userId;
                                        document.getElementById("table").rows[3].cells[1].innerHTML = regTime;
                                        document.getElementById("table").rows[5].cells[0].innerHTML = luid;
                                        var qrcode = new QRCode(document.getElementById("qrcode"), {
                                            text: `${luid}`,
                                            width: 128,
                                            height: 128,
                                            colorDark: "#000000",
                                            colorLight: "#ffffff",
                                            correctLevel: QRCode.CorrectLevel.H
                                        });
                                        document.getElementById("table").style.display = "table";
                                        document.getElementById("loading").style.display = "none";
                                    } else {
                                        alert('è·å–ç”¨æˆ·æ•°æ®å¤±è´¥ï¼');
                                    }
                                })
                                .catch(error => {
                                    console.error('è¯·æ±‚é”™è¯¯ï¼š', error);
                                    alert('è¯·æ±‚å‡ºé”™ï¼Œè¯·ç¨åé‡è¯•ï¼');
                                });
                        } else {
                            alert('è·å–idå¼‚å¸¸ï¼Œè¯·æ£€æŸ¥æ˜¯å¦ä¸ºNageki Netæ³¨å†Œå¡ï¼');
                        }
                    })
                    .catch(error => {
                        console.error('è¯·æ±‚é”™è¯¯ï¼š', error);
                        alert('è¯·æ±‚å‡ºé”™ï¼Œè¯·æ£€æŸ¥æ˜¯å¦ä¸ºNageki Netæ³¨å†Œå¡ï¼');
                    });
            }
            else {
                alert('äºŒç»´ç å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥å®¢æˆ·ç«¯æ˜¯å¦æ”¯æŒReigeki IDï¼');
            }
        }
    </script>
    <script language="JavaScript" type="text/javascript">readAimeId();</script>
</body>